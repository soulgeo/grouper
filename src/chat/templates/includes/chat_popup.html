<div hx-ext="ws" 
    ws-connect="/ws/chatroom/{{ room.id }}" 
    id="messages_room_{{ room.id }}"
    class="flex flex-col w-96 pointer-events-auto shadow-lg rounded-t-lg bottom-0">
    <div name="chat_popup_header" 
        class="flex flex-row items-center justify-between rounded-t-lg bg-base-300 p-3">
        {% include "includes/chat_popup_header_content.html" %}
        <div class="flex flex-row gap-2 items-center">
            <button onclick="(() => {
                var x = document.getElementById('chat_popup_content_{{ room.id }}');
                if (x.style.display === 'none') {
                    x.style.display = 'flex';
                } else {
                    x.style.display = 'none';
                }
            })()"
                class="btn btn-ghost btn-circle w-8 h-8 min-h-8">—</button>
            <button onclick="messages_room_{{ room.id }}.remove();"
                class="btn btn-ghost btn-circle w-8 h-8 min-h-8">✕</button>
        </div>
    </div>
    <div name="chat_popup_content" id="chat_popup_content_{{ room.id }}" class="flex flex-col h-[500px] bg-base-100 px-4 pb-4">
        <ul id="chat_messages_{{ room.id }}" class="flex flex-col flex-grow overflow-y-auto overflow-x-hidden pr-2 mb-4 py-1">
            {% for message in room.messages.all reversed %}
            {% include "includes/chat_message.html" %}
            {% endfor %}
        </ul>
        <div class="w-full bg-base-100 py-2">
            <form id="form_{{ room.id }}" ws-send 
                hx-on:htmx:ws-after-send="this.reset(); scrollToBottom_{{ room.id }}()" 
                hx-on:submit="setTimeout(() => this.reset(), 10)"
                class="flex gap-2">
                <input type="text" name="body" class="input input-bordered flex-grow" placeholder="Type a message..." autofocus>
                <button type="submit" class="btn btn-primary">Send</button>
            </form>
        </div>
    </div>
</div>
<script>
    function scrollToBottom_{{ room.id }}() {
        const container = document.getElementById('chat_messages_{{ room.id }}');
        if (container) {
            container.scrollTop = container.scrollHeight;
        }
    }
    scrollToBottom_{{ room.id }}();
</script>
